<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - multiple views</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="main.css">
    <style>
        /* body {
            background-color: rgb(18, 18, 18);
        } */

        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* verhindert Scrollbars */
            width: 100%;
            height: 100%;
        }

        #container {
            width: 100%;
            height: 100%;
            /* display: block; */
        }

        #fullscreenBtn {
            position: fixed;
            left: 10px;
            bottom: 10px;
            z-index: 10000; /* sehr hoch, damit es über Canvas liegt */
        }

        .logo {
            overflow-y: auto;
            position: absolute;
            top: 20px;
            right: 120Px;
            width: 100px;
            height: 100px;
            background-color: #246;
            border-radius: 0%;
            border-width: 0px; /*Optional*/
            display: inline-block;

        }
    </style>
</head>
<body>
<div id="info">
    <a class="logo" href="https://5dculture.eu"></a><img class="logo" src="./{{viewerPath}}assets/5dculture.png" alt="" style="width:100px;height:100px;" /></a>
</div>
<div id="container">
    <button id="fullscreenBtn" style="position:absolute; left:10px; bottom:10px;">Fullscreen</button>
</div>
<script type="importmap">
    {
        "imports": {
            "three": "./{{viewerPath}}modules/three.js-r170/build/three.module.js",
            "three/addons/": "./jsm/"
        }
    }
</script>

<script type="module">
    import * as THREE from './{{viewerPath}}modules/three.js-r170/build/three.module.js';
    import { GLTFLoader } from './{{viewerPath}}modules/three.js-r170/examples/jsm/loaders/GLTFLoader.js';

    let scene, camera, renderer;
    let model;

    init();
    animate();

    function init() {
        const container = document.getElementById('container');

        // Szene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000); // blauer Hintergrund

        // Kamera
        camera = new THREE.PerspectiveCamera(
            45,
            window.innerWidth / window.innerHeight,
            0.1,
            10000
        );
        camera.position.set(0, 1.5, 3);

        // Licht (simpel & stabil)
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));

        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(3, 5, 2);
        scene.add(dirLight);

        // Renderer
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // Modell laden (gleicher Loader wie bei dir)
        const loader = new GLTFLoader();
        const urlParams = new URLSearchParams(window.location.search);
        const modelUrl = urlParams.get('model');

        loader.load(modelUrl, (gltf) => {
            model = gltf.scene;

            const box = new THREE.Box3().setFromObject(model);
            const size = box.getSize(new THREE.Vector3());
            const center = box.getCenter(new THREE.Vector3());

            // Modell zentrieren
            model.position.sub(center);

            model.rotation.x = Math.PI; // 180° um die X-Achse

            scene.add(model);

            // Kamera automatisch passend einstellen
            const maxDim = Math.max(size.x, size.y, size.z);
            const fov = THREE.MathUtils.degToRad(camera.fov);

            let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
            cameraZ *= 1.3; // etwas Luft

            camera.position.set(0, 0, cameraZ);
            camera.near = cameraZ / 100;
            camera.far = cameraZ * 100;
            camera.updateProjectionMatrix();

            camera.lookAt(0, 0, 0);
        });


        window.addEventListener('resize', onResize);
    }

    function animate() {
        requestAnimationFrame(animate);

        if (model) {
            model.rotation.y += 0.005;
        }

        renderer.render(scene, camera);
    }

    function onResize() {
        const container = document.getElementById('container');
        const width = container.clientWidth;
        const height = container.clientHeight;
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize(width, height);
    }

    function enterFullscreen(element) {
        if (element.requestFullscreen) {
            element.requestFullscreen();
        } else if (element.webkitRequestFullscreen) { // Safari
            element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) { // IE11
            element.msRequestFullscreen();
        }
    }

    function leaveFullscreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) { // Safari
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { // IE11
            document.msExitFullscreen();
        }
    }

    const fsBtn = document.getElementById('fullscreenBtn');
    fsBtn.addEventListener('click', () => {
        if (!document.fullscreenElement) {
            enterFullscreen(document.getElementById('container'));
            fsBtn.textContent = 'Exit Fullscreen';
        } else {
            leaveFullscreen();
            fsBtn.textContent = 'Fullscreen';
        }
    });


</script>


</body>
</html>
